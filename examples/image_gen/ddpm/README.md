Adapted from https://github.com/tqch/ddpm-torch.