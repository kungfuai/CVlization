Adapted from https://github.com/hpcaitech/Open-Sora/blob/main/opensora/models/stdit/stdit.py